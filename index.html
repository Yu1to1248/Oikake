<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>追いかけっこゲーム</title>
<style>
  body {
    margin: 0; 
    display: flex; 
    flex-direction: column; 
    height: 100vh; 
    background: #eee; 
    font-family: sans-serif;
    user-select: none;
  }
  canvas {
    background: #fff;
    flex-grow: 1;
    display: block;
    margin: 0 auto;
    border: 2px solid #333;
  }
  .buttons {
    display: flex;
    justify-content: center;
    padding: 10px;
    gap: 10px;
    background: #ddd;
  }
  button {
    font-size: 24px;
    width: 60px;
    height: 60px;
    border-radius: 8px;
    border: none;
    background: #666;
    color: white;
    user-select: none;
    touch-action: manipulation;
  }
  button:active {
    background: #444;
  }
</style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<div class="buttons">
  <button id="up">↑</button>
  <button id="left">←</button>
  <button id="down">↓</button>
  <button id="right">→</button>
</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const player = { x: 50, y: 50, size: 30, speed: 10 };
  const enemy = { x: 300, y: 300, size: 30, speed: 2 };

  let gameOver = false;

  function drawRect(obj, color) {
    ctx.fillStyle = color;
    ctx.fillRect(obj.x, obj.y, obj.size, obj.size);
  }

  function clear() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function distance(a, b) {
    return Math.hypot(a.x - b.x, a.y - b.y);
  }

  function enemyChase() {
    const dx = player.x - enemy.x;
    const dy = player.y - enemy.y;
    const dist = Math.hypot(dx, dy);
    if (dist > 0) {
      enemy.x += (dx / dist) * enemy.speed;
      enemy.y += (dy / dist) * enemy.speed;
    }
  }

  function checkCollision() {
    return !(
      player.x + player.size < enemy.x ||
      enemy.x + enemy.size < player.x ||
      player.y + player.size < enemy.y ||
      enemy.y + enemy.size < player.y
    );
  }

  function draw() {
    clear();
    drawRect(player, "blue");
    drawRect(enemy, "red");

    if (checkCollision()) {
      gameOver = true;
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "40px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("ゲームオーバー！", canvas.width / 2, canvas.height / 2);
    }
  }

  function gameLoop() {
    if (!gameOver) {
      enemyChase();
      draw();
      requestAnimationFrame(gameLoop);
    }
  }

  function movePlayer(dx, dy) {
    if (gameOver) return;
    player.x += dx;
    player.y += dy;
    // 画面外に出ないように制限
    player.x = Math.min(Math.max(player.x, 0), canvas.width - player.size);
    player.y = Math.min(Math.max(player.y, 0), canvas.height - player.size);
  }

  // ボタンイベント
  document.getElementById("up").addEventListener("click", () => movePlayer(0, -player.speed));
  document.getElementById("down").addEventListener("click", () => movePlayer(0, player.speed));
  document.getElementById("left").addEventListener("click", () => movePlayer(-player.speed, 0));
  document.getElementById("right").addEventListener("click", () => movePlayer(player.speed, 0));

  draw();
  gameLoop();
</script>

</body>
</html>
